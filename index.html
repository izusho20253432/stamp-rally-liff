<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼QR</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2>ã‚¹ã‚¿ãƒ³ãƒ—ã‚’åŠ ç®—ä¸­...</h2>
  <div id="result"></div>

  <script>
    const liffId = "2008140201-3BvRrDMk"; // â˜…ç™ºè¡Œã•ã‚ŒãŸ LIFF ID
    const gasUrl = "https://script.google.com/macros/s/AKfycbxY5Rruk-ErtJY_u0Rk3U2WOUlXtdwzdhzZPkYu70tuO9-_Q2Ex8mbVy3Afw1kgCt9GXw/exec"; // â˜…GASã®URL

    async function main() {
      await liff.init({ liffId });

      if (!liff.isLoggedIn()) {
        liff.login({ scope: ["openid", "profile"] });
        return;
      }

      // ğŸ‘‡ã“ã“ã§ idToken ã‚’ç¢ºèª
      const idToken = liff.getIDToken();
      console.log("idToken:", idToken);

      // QRã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
      const params = new URLSearchParams(window.location.search);
      // const shopId = params.get("shopId");
      const shopId = "1001"; // â† ãƒ†ã‚¹ãƒˆç”¨ã«å›ºå®š

      if (!shopId) {
        document.getElementById("result").innerText = "âŒ shopId ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
        return;
      }

      // idTokenã‚’GASã«é€ã‚‹ï¼ˆverifyç”¨ï¼‰
     const url = `${gasUrl}?mode=stamp&idToken=${idToken}&shopId=${shopId}`;

      try {
        const res = await fetch(url);
        const text = await res.text();
        console.log("GAS response:", text);
        document.getElementById("result").innerText = "âœ… ã‚¹ã‚¿ãƒ³ãƒ—åŠ ç®—å®Œäº†ï¼";
      } catch (e) {
        console.error(e);
        document.getElementById("result").innerText = "âš ï¸ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
      }
    }

    main();
  </script>
</body>
</html>

